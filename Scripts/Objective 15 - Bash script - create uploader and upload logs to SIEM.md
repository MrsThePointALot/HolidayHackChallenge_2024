```
cd $home && cd elf-stack-siem
b64="IyEvdXNyL2Jpbi9weXRob24zDQppbXBvcnQgYXN5bmNpbw0KaW1wb3J0IHN5cw0KaW1wb3J0IG9zDQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZXpvbmUNCmltcG9ydCBhaW9odHRwDQppbXBvcnQganNvbg0KaW1wb3J0IHJlDQppbXBvcnQgY2hhcmRldA0KaW1wb3J0IHNvY2tldA0KaW1wb3J0IG5ldGlmYWNlcw0KaW1wb3J0IHJlcXVlc3RzDQppbXBvcnQgdGltZQ0KaW1wb3J0IGFyZ3BhcnNlDQoNCmRlZiBnZXRfaXAoKToNCiAgICBmb3IgaW50ZXJmYWNlIGluIG5ldGlmYWNlcy5pbnRlcmZhY2VzKCk6DQogICAgICAgIGFkZHJzID0gbmV0aWZhY2VzLmlmYWRkcmVzc2VzKGludGVyZmFjZSkNCiAgICAgICAgaWYgbmV0aWZhY2VzLkFGX0lORVQgaW4gYWRkcnM6ICAjIElQdjQgYWRkcmVzc2VzIGV4aXN0DQogICAgICAgICAgICBmb3IgYWRkciBpbiBhZGRyc1tuZXRpZmFjZXMuQUZfSU5FVF06DQogICAgICAgICAgICAgICAgaXAgPSBhZGRyWydhZGRyJ10NCiAgICAgICAgICAgICAgICBpZiBub3QgaXAuc3RhcnRzd2l0aCgnMTI3LicpOiAgIyBTa2lwIGxvb3BiYWNrDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpcA0KICAgIHJldHVybiBOb25lDQoNCiMgUGFyc2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cw0KcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoZGVzY3JpcHRpb249J1VwbG9hZCBsb2dzIHRvIEVsYXN0aWNzZWFyY2gnKQ0KcGFyc2VyLmFkZF9hcmd1bWVudCgnLS1sb2dzJywgZGVmYXVsdD0nYWxsX2xvZ3MubG9nJywgaGVscD0nUGF0aCB0byB0aGUgbG9nIGZpbGUgdG8gcHJvY2VzcyAoZGVmYXVsdDogYWxsX2xvZ3MubG9nKScpDQpwYXJzZXIuYWRkX2FyZ3VtZW50KCctLWhvc3QnLCBkZWZhdWx0PSdsb2NhbGhvc3QnLCBoZWxwPSdFbGFzdGljc2VhcmNoIGhvc3QgSVAgYWRkcmVzcyAoZGVmYXVsdDogbG9jYWxob3N0KScpDQphcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQ0KDQojIENvbmZpZ3VyYXRpb24NCkVMQVNUSUNfSE9TVCA9IGYnaHR0cDovL3thcmdzLmhvc3R9OjkyMDAnDQpFTEFTVElDX1VTRVIgPSAnZWxhc3RpYycNCkVMQVNUSUNfUEFTU1dPUkQgPSAnRUxGc3RhY2tMb2dpbiEnDQpCQVRDSF9TSVpFID0gMTAwMDANCklOREVYX05BTUUgPSAibG9ncyINCnJmY19wYXR0ZXJuID0gciI8KD9QPGZhY2lsaXR5PlxkKyk+KD9QPHZlcnNpb24+XGQrKSAoP1A8dGltZXN0YW1wPltcZFwtVDouK10rKSAoP1A8aG9zdG5hbWU+XFMrKSAoP1A8YXBwX25hbWU+XFMrKSAoP1A8cHJvY19pZD4tKSAoP1A8bXNnX2lkPi0pICg/UDxzdHJ1Y3R1cmVkX2RhdGE+LSkoPzpccysoP1A8bWVzc2FnZT4uKykpPyINCg0KZGVmIHdhaXRfZm9yX2VsYXN0aWModXJpPUVMQVNUSUNfSE9TVCwgdXNlcj1Ob25lLCBwYXNzd29yZD1Ob25lLCBkZWxheT0yKToNCiAgICB1cmwgPSBmInt1cml9L19jbHVzdGVyL2hlYWx0aCINCiAgICBhdXRoID0gKHVzZXIsIHBhc3N3b3JkKSBpZiB1c2VyIGFuZCBwYXNzd29yZCBlbHNlIE5vbmUNCiAgICANCiAgICBhdHRlbXB0ID0gMQ0KICAgIHdoaWxlIFRydWU6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgYXV0aD1hdXRoKQ0KICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOg0KICAgICAgICAgICAgICAgIGhlYWx0aCA9IHJlc3BvbnNlLmpzb24oKQ0KICAgICAgICAgICAgICAgIHN0YXR1cyA9IGhlYWx0aC5nZXQoJ3N0YXR1cycpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yOg0KICAgICAgICAgICAgcHJpbnQoZiJBdHRlbXB0IHthdHRlbXB0fTogRWxhc3RpY3NlYXJjaCBub3QgcmVhZHkgeWV0Li4uIikNCiAgICAgICAgICAgIGF0dGVtcHQgKz0gMQ0KICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheSkNCg0Kd2FpdF9mb3JfZWxhc3RpYyh1cmk9RUxBU1RJQ19IT1NULCB1c2VyPUVMQVNUSUNfVVNFUiwgcGFzc3dvcmQ9RUxBU1RJQ19QQVNTV09SRCkNCnByaW50KCJFbGFzdGljU2VhcmNoIGlzIHJlYWR5IC0gcnVubmluZyBpbXBvcnQgc2NyaXB0IikNCg0KZGVmIGRldGVjdF9maWxlX2VuY29kaW5nKGZpbGVfcGF0aCk6DQogICAgIiIiRGV0ZWN0IHRoZSBlbmNvZGluZyBvZiBhIGZpbGUgYW5kIGRlZmF1bHQgdG8gVVRGLTggaWYgbmVjZXNzYXJ5IiIiDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3JiJykgYXMgZjoNCiAgICAgICAgcmF3X2RhdGEgPSBmLnJlYWQoMTAwMDApICAjIFJlYWQgYSBwb3J0aW9uIG9mIHRoZSBmaWxlDQogICAgcmVzdWx0ID0gY2hhcmRldC5kZXRlY3QocmF3X2RhdGEpDQogICAgZW5jb2RpbmcgPSByZXN1bHRbJ2VuY29kaW5nJ10NCiAgICAjIERlZmF1bHQgdG8gVVRGLTggaWYgQVNDSUkgaXMgZGV0ZWN0ZWQsIGFzIEFTQ0lJIGlzIGEgc3Vic2V0IG9mIFVURi04DQogICAgaWYgZW5jb2RpbmcubG93ZXIoKSA9PSAnYXNjaWknOg0KICAgICAgICBlbmNvZGluZyA9ICd1dGYtOCcNCiAgICByZXR1cm4gZW5jb2RpbmcNCg0KZGVmIGV4dHJhY3RfanNvbl9hbmRfcmZjKGxpbmU6IHN0cikgLT4gdHVwbGU6DQogICAgIiIiRXh0cmFjdCBib3RoIEpTT04gYW5kIFJGQyBzdGFuZGFyZCB0ZXh0IGZyb20gYSBsaW5lIiIiDQogICAgdHJ5Og0KICAgICAgICAjIEZpbmQgdGhlIGZpcnN0IHsgYW5kIGxhc3QgfSB0byBleHRyYWN0IEpTT04NCiAgICAgICAgc3RhcnQgPSBsaW5lLmZpbmQoJ3snKQ0KICAgICAgICBlbmQgPSBsaW5lLnJmaW5kKCd9JykgKyAxDQogICAgICAgIA0KICAgICAgICBpZiBzdGFydCA9PSAtMSBvciBlbmQgPT0gMDoNCiAgICAgICAgICAgIHJldHVybiBOb25lLCBsaW5lICAjIE5vIEpTT04gZm91bmQsIHRyZWF0IGVudGlyZSBsaW5lIGFzIFJGQyB0ZXh0DQogICAgICAgICAgICANCiAgICAgICAgIyBFeHRyYWN0IEpTT04gYW5kIFJGQyBwYXJ0cw0KICAgICAgICBqc29uX3N0ciA9IGxpbmVbc3RhcnQ6ZW5kXQ0KICAgICAgICByZmNfdGV4dCA9IGxpbmVbOnN0YXJ0XS5zdHJpcCgpDQogICAgICAgIA0KICAgICAgICAjIFBhcnNlIEpTT04NCiAgICAgICAganNvbl9vYmogPSBqc29uLmxvYWRzKGpzb25fc3RyKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGpzb25fb2JqLCByZmNfdGV4dC5zdHJpcCgpDQogICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOg0KICAgICAgICByZXR1cm4gTm9uZSwgbGluZQ0KDQpkZWYgZXh0cmFjdF9yZmNfZmllbGRzKHJmY190ZXh0OiBzdHIpIC0+IGRpY3Q6DQogICAgIiIiRXh0cmFjdCBmaWVsZHMgZnJvbSBSRkMgdGV4dCIiIg0KICAgIG1hdGNoID0gcmUubWF0Y2gocmZjX3BhdHRlcm4sIHJmY190ZXh0KQ0KICAgIGlmIG1hdGNoOg0KICAgICAgICBmaWVsZHMgPSBtYXRjaC5ncm91cGRpY3QoKQ0KICAgICAgICANCiAgICAgICAgIyBDb252ZXJ0IGZhY2lsaXR5IGFuZCBzZXZlcml0eSBmcm9tIHRoZSBjb21iaW5lZCBjb2RlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNvbWJpbmVkID0gaW50KGZpZWxkc1snZmFjaWxpdHknXSkNCiAgICAgICAgICAgICMgU3lzbG9nIGZhY2lsaXR5IGlzIHRoZSBoaWdoZXIgYml0cyAoc2hpZnRlZCByaWdodCBieSAzKQ0KICAgICAgICAgICAgZmllbGRzWydmYWNpbGl0eSddID0gY29tYmluZWQgPj4gMw0KICAgICAgICAgICAgIyBTZXZlcml0eSBpcyB0aGUgbG93ZXIgMyBiaXRzDQogICAgICAgICAgICBmaWVsZHNbJ3NldmVyaXR5J10gPSBjb21iaW5lZCAmIDB4Nw0KICAgICAgICBleGNlcHQgKFZhbHVlRXJyb3IsIFR5cGVFcnJvcik6DQogICAgICAgICAgICBwYXNzDQogICAgICAgICAgICANCiAgICAgICAgIyBDb252ZXJ0IHRpbWVzdGFtcCB0byBwcm9wZXIgZGF0ZXRpbWUgZm9ybWF0DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChmaWVsZHNbJ3RpbWVzdGFtcCddKQ0KICAgICAgICAgICAgZmllbGRzWyd0aW1lc3RhbXAnXSA9IGR0Lmlzb2Zvcm1hdCgpDQogICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgVHlwZUVycm9yKToNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gZmllbGRzDQogICAgcmV0dXJuIHt9DQoNCmRlZiBwcm9jZXNzX2RvY3VtZW50KGRvYzogZGljdCwgcmZjX3RleHQ6IHN0ciA9ICIiKSAtPiBkaWN0Og0KICAgICIiIlByb2Nlc3MgZG9jdW1lbnQgYW5kIGVuc3VyZSBmaWVsZHMgYXJlIHByb3Blcmx5IGZvcm1hdHRlZCIiIg0KICAgIHByb2Nlc3NlZCA9IHsNCiAgICAgICAgJ0B0aW1lc3RhbXAnOiBkYXRldGltZS5ub3codGltZXpvbmUudXRjKS5pc29mb3JtYXQoKSwNCiAgICAgICAgJ2RhdGFfc3RyZWFtJzogew0KICAgICAgICAgICAgJ25hbWVzcGFjZSc6ICdkZWZhdWx0JywNCiAgICAgICAgICAgICd0eXBlJzogJ2xvZ3MnLA0KICAgICAgICAgICAgJ2RhdGFzZXQnOiAnZ2VuZXJpYycNCiAgICAgICAgfSwNCiAgICAgICAgJ0B2ZXJzaW9uJzogJzEnLA0KICAgICAgICAndHlwZSc6ICdzeXNsb2cnLA0KICAgICAgICAndGFncyc6IFsnbWF0Y2gnXSwNCiAgICAgICAgJ2hvc3QnOiB7J2lwJzogJzE3Mi4xOC4wLjUnfQ0KICAgIH0NCiAgICANCiAgICAjIEV4dHJhY3QgUkZDIGZpZWxkcyBpZiBwcmVzZW50DQogICAgaWYgcmZjX3RleHQ6DQogICAgICAgIHJmY19maWVsZHMgPSBleHRyYWN0X3JmY19maWVsZHMocmZjX3RleHQpDQogICAgICAgIGlmIHJmY19maWVsZHM6DQogICAgICAgICAgICBwcm9jZXNzZWQudXBkYXRlKHsNCiAgICAgICAgICAgICAgICAnaG9zdG5hbWUnOiByZmNfZmllbGRzLmdldCgnaG9zdG5hbWUnKSwNCiAgICAgICAgICAgICAgICAnZXZlbnRfc291cmNlJzogcmZjX2ZpZWxkcy5nZXQoJ2FwcF9uYW1lJyksDQogICAgICAgICAgICAgICAgJ2xvZyc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ3N5c2xvZyc6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICdzZXZlcml0eSc6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29kZSc6IHJmY19maWVsZHMuZ2V0KCdzZXZlcml0eScpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogZ2V0X3NldmVyaXR5X25hbWUocmZjX2ZpZWxkcy5nZXQoJ3NldmVyaXR5JykpDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2ZhY2lsaXR5Jzogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2RlJzogMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICd1c2VyLWxldmVsJw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICANCiAgICAjIENyZWF0ZSBldmVudCBvYmplY3QNCiAgICBldmVudCA9IHt9DQogICAgDQogICAgIyBUcmFjayBpZiB3ZSd2ZSBmb3VuZCBhIHZhbGlkIGRhdGUgZmllbGQNCiAgICBmb3VuZF92YWxpZF9kYXRlID0gRmFsc2UNCiAgICBldmVudF9yZWNlaXZlZF90aW1lID0gTm9uZSAgIyBUcmFjayBFdmVudFJlY2VpdmVkVGltZSBpZiBmb3VuZA0KICAgIA0KICAgICMgRmlyc3QgcGFzcyB0byBmaW5kIEV2ZW50UmVjZWl2ZWRUaW1lDQogICAgaWYgJ0V2ZW50UmVjZWl2ZWRUaW1lJyBpbiBkb2MgYW5kIGlzaW5zdGFuY2UoZG9jWydFdmVudFJlY2VpdmVkVGltZSddLCBzdHIpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiAnICcgaW4gZG9jWydFdmVudFJlY2VpdmVkVGltZSddOg0KICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuc3RycHRpbWUoZG9jWydFdmVudFJlY2VpdmVkVGltZSddLCAnJVktJW0tJWQgJUg6JU06JVMnKQ0KICAgICAgICAgICAgICAgIGV2ZW50X3JlY2VpdmVkX3RpbWUgPSBkdC5zdHJmdGltZSgnJVktJW0tJWRUJUg6JU06JVMuMDAwWicpDQogICAgICAgICAgICBlbGlmICdaLScgaW4gZG9jWydFdmVudFJlY2VpdmVkVGltZSddIG9yICdaKycgaW4gZG9jWydFdmVudFJlY2VpdmVkVGltZSddOg0KICAgICAgICAgICAgICAgIGNsZWFuX3ZhbHVlID0gZG9jWydFdmVudFJlY2VpdmVkVGltZSddLnJlcGxhY2UoJ1onLCAnJykNCiAgICAgICAgICAgICAgICBkdCA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQoY2xlYW5fdmFsdWUpDQogICAgICAgICAgICAgICAgdXRjX2R0ID0gZHQuYXN0aW1lem9uZSh0aW1lem9uZS51dGMpDQogICAgICAgICAgICAgICAgZXZlbnRfcmVjZWl2ZWRfdGltZSA9IHV0Y19kdC5zdHJmdGltZSgnJVktJW0tJWRUJUg6JU06JVMuJWZaJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZXZlbnRfcmVjZWl2ZWRfdGltZSA9IGRvY1snRXZlbnRSZWNlaXZlZFRpbWUnXQ0KICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoNCiAgICAgICAgICAgIHBhc3MNCiAgICANCiAgICAjIFByb2Nlc3MgYWxsIGZpZWxkcyBpbnRvIGV2ZW50IHN0cnVjdHVyZQ0KICAgIGZvciBrZXksIHZhbHVlIGluIGRvYy5pdGVtcygpOg0KICAgICAgICAjIEhhbmRsZSBkYXRlIGZpZWxkcw0KICAgICAgICBpZiBrZXkgaW4gWydFdmVudFRpbWUnLCAnRGF0ZScsICdFdmVudFJlY2VpdmVkVGltZScsICdUaW1lQ3JlYXRlZF9TeXN0ZW1UaW1lJywgJ3RpbWVzdGFtcCcsICdSZWNlaXZlZF9UaW1lJywgJ3RpbWVzdGFtcF9zdGFydCddOg0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyKToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmICcgJyBpbiB2YWx1ZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuc3RycHRpbWUodmFsdWUsICclWS0lbS0lZCAlSDolTTolUycpDQogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRfdGltZSA9IGR0LnN0cmZ0aW1lKCclWS0lbS0lZFQlSDolTTolUy4wMDBaJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnWi0nIGluIHZhbHVlIG9yICdaKycgaW4gdmFsdWU6DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhbl92YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJ1onLCAnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChjbGVhbl92YWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y19kdCA9IGR0LmFzdGltZXpvbmUodGltZXpvbmUudXRjKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkX3RpbWUgPSB1dGNfZHQuc3RyZnRpbWUoJyVZLSVtLSVkVCVIOiVNOiVTLiVmWicpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRfdGltZSA9IHZhbHVlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAjIElmIHRoaXMgaXMgRXZlbnRUaW1lIGFuZCB3ZSBoYXZlIEV2ZW50UmVjZWl2ZWRUaW1lLCB1c2UgRXZlbnRSZWNlaXZlZFRpbWUNCiAgICAgICAgICAgICAgICAgICAgaWYga2V5ID09ICdFdmVudFRpbWUnIGFuZCBldmVudF9yZWNlaXZlZF90aW1lOg0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRba2V5XSA9IGV2ZW50X3JlY2VpdmVkX3RpbWUNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50W2tleV0gPSBmb3JtYXR0ZWRfdGltZQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgIyBTZXQgQHRpbWVzdGFtcCBiYXNlZCBvbiBwcmlvcml0eQ0KICAgICAgICAgICAgICAgICAgICBpZiBldmVudF9yZWNlaXZlZF90aW1lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkWydAdGltZXN0YW1wJ10gPSBldmVudF9yZWNlaXZlZF90aW1lDQogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF92YWxpZF9kYXRlID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGtleSBpbiBbJ0V2ZW50VGltZScsICdEYXRlJywgJ3RpbWVzdGFtcCcsICdUaW1lQ3JlYXRlZF9TeXN0ZW1UaW1lJywgJ1JlY2VpdmVkX1RpbWUnLCAndGltZXN0YW1wX3N0YXJ0J106DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWRbJ0B0aW1lc3RhbXAnXSA9IGZvcm1hdHRlZF90aW1lDQogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF92YWxpZF9kYXRlID0gVHJ1ZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOg0KICAgICAgICAgICAgICAgICAgICBldmVudFtrZXldID0gdmFsdWUNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICMgSGFuZGxlIG90aGVyIGZpZWxkcyBhcyBiZWZvcmUuLi4NCiAgICAgICAgZWxpZiBrZXkgPT0gJ0tleXdvcmRzJzoNCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChpbnQsIGZsb2F0KSk6DQogICAgICAgICAgICAgICAgZXZlbnRba2V5XSA9IHN0cih2YWx1ZSkNCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyKToNCiAgICAgICAgICAgICAgICBldmVudFtrZXldID0gdmFsdWUucmVwbGFjZSgnMHgnLCAnJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZXZlbnRba2V5XSA9ICIwIg0KICAgICAgICAjIEZpZWxkcyB0aGF0IHNob3VsZCBzdGF5IGF0IHJvb3QgbGV2ZWwNCiAgICAgICAgZWxpZiBrZXkgaW4gWydob3N0bmFtZScsICdldmVudF9zb3VyY2UnXToNCiAgICAgICAgICAgIHByb2Nlc3NlZFtrZXldID0gdmFsdWUNCiAgICAgICAgIyBIYW5kbGUgc3BlY2lhbCBmaWVsZHMNCiAgICAgICAgZWxpZiBrZXkgPT0gJ09wY29kZSc6DQogICAgICAgICAgICBldmVudFtrZXldID0gc3RyKHZhbHVlKQ0KICAgICAgICBlbGlmIGtleSA9PSAnUHJvdG9jb2wnOg0KICAgICAgICAgICAgZXZlbnRba2V5XSA9IHN0cih2YWx1ZSkNCiAgICAgICAgZWxpZiBrZXkgPT0gJ1R5cGUnOg0KICAgICAgICAgICAgZXZlbnRba2V5XSA9IHN0cih2YWx1ZSkNCiAgICAgICAgZWxpZiBrZXkgaW4gWydXZWlnaHQnLCAnQWRkaXRpb25hbEluZm9ybWF0aW9uX1dlaWdodCddOg0KICAgICAgICAgICAgZXZlbnRba2V5XSA9IHN0cih2YWx1ZSkNCiAgICAgICAgZWxpZiBrZXkgaW4gWydFcnJvckNvZGUnLCAnU3RhdHVzJywgJ1JldHVybkNvZGUnLCAnQ3J5cHRvZ3JhcGhpY09wZXJhdGlvbl9SZXR1cm5Db2RlJ106DQogICAgICAgICAgICBldmVudFtrZXldID0gc3RyKHZhbHVlKQ0KICAgICAgICBlbGlmIGtleSBpbiBbJ05ldHdvcmtJbmZvcm1hdGlvbl9Tb3VyY2VQb3J0JywgJ05ldHdvcmtJbmZvcm1hdGlvbl9EZXN0aW5hdGlvblBvcnQnLCANCiAgICAgICAgICAgICAgICAgICAgJ05ldHdvcmtJbmZvcm1hdGlvbl9Qb3J0JywgJ0lwUG9ydCcsICdTb3VyY2VQb3J0JywgJ0Rlc3RQb3J0J106DQogICAgICAgICAgICBpZiB2YWx1ZSA9PSAnLScgb3IgdmFsdWUgPT0gJyc6DQogICAgICAgICAgICAgICAgZXZlbnRba2V5XSA9IE5vbmUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBldmVudFtrZXldID0gaW50KHZhbHVlKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgVHlwZUVycm9yKToNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRba2V5XSA9IE5vbmUNCiAgICAgICAgIyBTa2lwIGxvd2VyY2FzZSBwcm9jZXNzSWQNCiAgICAgICAgZWxpZiBrZXkgPT0gJ1Byb2Nlc3NJZCc6DQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAjIEFsbCBvdGhlciBmaWVsZHMgZ28gaW50byBldmVudCBvYmplY3QNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGV2ZW50W2tleV0gPSB2YWx1ZQ0KICAgIA0KICAgIGlmIGV2ZW50Og0KICAgICAgICBwcm9jZXNzZWRbJ2V2ZW50J10gPSBldmVudA0KICAgIA0KICAgICMgQ2hlY2sgaWYgd2UgZm91bmQgYSB2YWxpZCBkYXRlIGZpZWxkDQogICAgaWYgbm90IGZvdW5kX3ZhbGlkX2RhdGU6DQogICAgICAgIHByaW50KCJFUlJPUjogTm8gdmFsaWQgZGF0ZSBmaWVsZCAoRXZlbnRUaW1lIG9yIERhdGUpIGZvdW5kIGluIHJlY29yZDoiKQ0KICAgICAgICBwcmludChqc29uLmR1bXBzKGRvYywgaW5kZW50PTIpKQ0KICAgICAgICBzeXMuZXhpdCgxKQ0KICAgIA0KICAgIHJldHVybiBwcm9jZXNzZWQNCg0KZGVmIGdldF9zZXZlcml0eV9uYW1lKGNvZGUpOg0KICAgICIiIk1hcCBzZXZlcml0eSBjb2RlIHRvIG5hbWUiIiINCiAgICBzZXZlcml0eV9tYXAgPSB7DQogICAgICAgIDA6ICdlbWVyZ2VuY3knLA0KICAgICAgICAxOiAnYWxlcnQnLA0KICAgICAgICAyOiAnY3JpdGljYWwnLA0KICAgICAgICAzOiAnZXJyb3InLA0KICAgICAgICA0OiAnd2FybmluZycsDQogICAgICAgIDU6ICdub3RpY2UnLA0KICAgICAgICA2OiAnaW5mb3JtYXRpb25hbCcsDQogICAgICAgIDc6ICdkZWJ1ZycNCiAgICB9DQogICAgcmV0dXJuIHNldmVyaXR5X21hcC5nZXQoY29kZSwgJ3Vua25vd24nKQ0KDQphc3luYyBkZWYgc2VuZF9iYXRjaChzZXNzaW9uLCBiYXRjaCwgYmF0Y2hfbnVtKToNCiAgICAiIiJTZW5kIGEgYmF0Y2ggb2YgZG9jdW1lbnRzIHRvIEVsYXN0aWNzZWFyY2giIiINCiAgICBpZiBub3QgYmF0Y2g6DQogICAgICAgIHJldHVybiAwDQoNCiAgICBidWxrX2JvZHkgPSAiIg0KICAgIGZvciBkb2MgaW4gYmF0Y2g6DQogICAgICAgIGFjdGlvbiA9IHsiaW5kZXgiOiB7Il9pbmRleCI6IElOREVYX05BTUV9fQ0KICAgICAgICBidWxrX2JvZHkgKz0ganNvbi5kdW1wcyhhY3Rpb24pICsgIlxuIg0KICAgICAgICBidWxrX2JvZHkgKz0ganNvbi5kdW1wcyhkb2MpICsgIlxuIg0KDQogICAgdHJ5Og0KICAgICAgICBhc3luYyB3aXRoIHNlc3Npb24ucG9zdCgNCiAgICAgICAgICAgIGYie0VMQVNUSUNfSE9TVH0vX2J1bGsiLA0KICAgICAgICAgICAgZGF0YT1idWxrX2JvZHksDQogICAgICAgICAgICBoZWFkZXJzPXsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtbmRqc29uJ30sDQogICAgICAgICAgICBhdXRoPWFpb2h0dHAuQmFzaWNBdXRoKEVMQVNUSUNfVVNFUiwgRUxBU1RJQ19QQVNTV09SRCkNCiAgICAgICAgKSBhcyByZXNwb25zZToNCiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAnZXJyb3JzJyBpbiByZXN1bHQgYW5kIHJlc3VsdFsnZXJyb3JzJ106DQogICAgICAgICAgICAgICAgcHJpbnQoZiJcbkJhdGNoIHtiYXRjaF9udW19IGhhZCBlcnJvcnM6IikNCiAgICAgICAgICAgICAgICBmb3IgaSwgaXRlbSBpbiBlbnVtZXJhdGUocmVzdWx0WydpdGVtcyddKToNCiAgICAgICAgICAgICAgICAgICAgaW5kZXhfcmVzdWx0ID0gaXRlbS5nZXQoJ2luZGV4Jywge30pDQogICAgICAgICAgICAgICAgICAgIGlmIGluZGV4X3Jlc3VsdC5nZXQoJ3N0YXR1cycpICE9IDIwMToNCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gaW5kZXhfcmVzdWx0LmdldCgnZXJyb3InLCB7fSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG5Eb2N1bWVudCBmYWlsZWQgd2l0aCBzdGF0dXMge2luZGV4X3Jlc3VsdC5nZXQoJ3N0YXR1cycpfToiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJFcnJvciB0eXBlOiB7ZXJyb3IuZ2V0KCd0eXBlJyl9IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgcmVhc29uOiB7ZXJyb3IuZ2V0KCdyZWFzb24nKX0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJGYWlsZWQgZG9jdW1lbnQ6IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGpzb24uZHVtcHMoYmF0Y2hbaV0sIGluZGVudD0yKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgc3VjY2Vzc2Z1bF9kb2NzID0gc3VtKDEgZm9yIGl0ZW0gaW4gcmVzdWx0WydpdGVtcyddIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmdldCgnaW5kZXgnLCB7fSkuZ2V0KCdzdGF0dXMnKSA9PSAyMDEpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBzdWNjZXNzZnVsX2RvY3MNCiAgICAgICAgICAgIA0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJFcnJvciBzZW5kaW5nIGJhdGNoIHtiYXRjaF9udW19OiB7ZX0iKQ0KICAgICAgICByZXR1cm4gMA0KDQphc3luYyBkZWYgZGVsZXRlX2FuZF9jcmVhdGVfaW5kZXgoc2Vzc2lvbik6DQogICAgIiIiRGVsZXRlIGV4aXN0aW5nIGluZGV4IGFuZCBjcmVhdGUgYSBuZXcgb25lIHdpdGggcHJvcGVyIG1hcHBpbmdzIiIiDQogICAgdHJ5Og0KICAgICAgICBhc3luYyB3aXRoIHNlc3Npb24uZGVsZXRlKA0KICAgICAgICAgICAgZiJ7RUxBU1RJQ19IT1NUfS97SU5ERVhfTkFNRX0iLA0KICAgICAgICAgICAgYXV0aD1haW9odHRwLkJhc2ljQXV0aChFTEFTVElDX1VTRVIsIEVMQVNUSUNfUEFTU1dPUkQpDQogICAgICAgICkgYXMgcmVzcG9uc2U6DQogICAgICAgICAgICBwcmludChmIkRlbGV0aW5nIG9sZCBpbmRleDoge2F3YWl0IHJlc3BvbnNlLnRleHQoKX0iKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgIHBhc3MNCg0KICAgICMgVGhlbiBjcmVhdGUgaW5kZXggd2l0aCBtYXBwaW5ncywgaW5jbHVkaW5nIHRoZSBmaWVsZCBsaW1pdA0KICAgIHNldHRpbmdzID0gew0KICAgICAgICAic2V0dGluZ3MiOiB7DQogICAgICAgICAgICAibnVtYmVyX29mX3NoYXJkcyI6IDEsDQogICAgICAgICAgICAibnVtYmVyX29mX3JlcGxpY2FzIjogMCwNCiAgICAgICAgICAgICJpbmRleC5tYXBwaW5nLnRvdGFsX2ZpZWxkcy5saW1pdCI6IDIwMDAwICAjIEluY3JlYXNlZCB0byBoYW5kbGUgV2luZG93cyBFdmVudCBsb2dzDQogICAgICAgIH0sDQogICAgICAgICJtYXBwaW5ncyI6IHsNCiAgICAgICAgICAgICJkeW5hbWljX3RlbXBsYXRlcyI6IFsNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICJzdHJpbmdzX2FzX2tleXdvcmRzIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgIm1hdGNoX21hcHBpbmdfdHlwZSI6ICJzdHJpbmciLA0KICAgICAgICAgICAgICAgICAgICAgICAgIm1hcHBpbmciOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAia2V5d29yZCINCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF0sDQogICAgICAgICAgICAicHJvcGVydGllcyI6IHsNCiAgICAgICAgICAgICAgICAiQHRpbWVzdGFtcCI6IHsidHlwZSI6ICJkYXRlIn0sDQogICAgICAgICAgICAgICAgImV2ZW50Ijogew0KICAgICAgICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICJFdmVudFRpbWUiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiZGF0ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvcm1hdCI6ICJzdHJpY3RfZGF0ZV9vcHRpb25hbF90aW1lfHx5eXl5LU1NLWRkIEhIOm1tOnNzfHx5eXl5LU1NLWRkJ1QnSEg6bW06c3MuU1NTU1NTWnx8ZXBvY2hfbWlsbGlzfHxiYXNpY19kYXRlX3RpbWVfbm9fbWlsbGlzIg0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJMZXZlbCI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiRXZlbnRSZWNlaXZlZFRpbWUiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiZGF0ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvcm1hdCI6ICJzdHJpY3RfZGF0ZV9vcHRpb25hbF90aW1lfHx5eXl5LU1NLWRkIEhIOm1tOnNzfHx5eXl5LU1NLWRkJ1QnSEg6bW06c3MuU1NTU1NTWnx8ZXBvY2hfbWlsbGlzIg0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJLZXl3b3JkcyI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiRXZlbnRUeXBlIjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTZXZlcml0eVZhbHVlIjogeyJ0eXBlIjogImxvbmcifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTZXZlcml0eSI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiRXZlbnRJRCI6IHsidHlwZSI6ICJsb25nIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiU291cmNlTmFtZSI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiUHJvdmlkZXJHdWlkIjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJWZXJzaW9uIjogeyJ0eXBlIjogImxvbmcifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJUYXNrIjogeyJ0eXBlIjogImxvbmcifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJPcGNvZGVWYWx1ZSI6IHsidHlwZSI6ICJsb25nIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiT3Bjb2RlIjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJPcGNvZGVEaXNwbGF5TmFtZVRleHQiOiB7InR5cGUiOiAia2V5d29yZCJ9LA0KICAgICAgICAgICAgICAgICAgICAgICAgIlJlY29yZE51bWJlciI6IHsidHlwZSI6ICJsb25nIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiUHJvY2Vzc0lEIjogeyJ0eXBlIjogImxvbmcifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJUaHJlYWRJRCI6IHsidHlwZSI6ICJsb25nIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiQ2hhbm5lbCI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiQ2F0ZWdvcnkiOiB7InR5cGUiOiAia2V5d29yZCJ9LA0KICAgICAgICAgICAgICAgICAgICAgICAgIk5ldHdvcmtJbmZvcm1hdGlvbl9Tb3VyY2VQb3J0Ijogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImxvbmciLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudWxsX3ZhbHVlIjogTm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJOZXR3b3JrSW5mb3JtYXRpb25fRGVzdGluYXRpb25Qb3J0Ijogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImxvbmciLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudWxsX3ZhbHVlIjogTm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJJcFBvcnQiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAibG9uZyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm51bGxfdmFsdWUiOiBOb25lDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgIlByb2Nlc3NJbmZvcm1hdGlvbl9Qcm9jZXNzSUQiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAia2V5d29yZCINCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAiRGV0YWlsZWRBdXRoZW50aWNhdGlvbkluZm9ybWF0aW9uX0tleUxlbmd0aCI6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJsb25nIg0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJQcm90b2NvbCI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiV2VpZ2h0IjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJBZGRpdGlvbmFsSW5mb3JtYXRpb25fV2VpZ2h0IjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJUeXBlIjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJFcnJvclN0YXRlIjogeyJ0eXBlIjogImxvbmcifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJFcnJvckNvZGUiOiB7InR5cGUiOiAia2V5d29yZCJ9LA0KICAgICAgICAgICAgICAgICAgICAgICAgIlN0YXR1cyI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiUmV0dXJuQ29kZSI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAiQ3J5cHRvZ3JhcGhpY09wZXJhdGlvbl9SZXR1cm5Db2RlIjogeyJ0eXBlIjogImtleXdvcmQifSwNCiAgICAgICAgICAgICAgICAgICAgICAgICIqIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImtleXdvcmQiDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICJsb2ciOiB7DQogICAgICAgICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgInN5c2xvZyI6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldmVyaXR5Ijogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvZGUiOiB7InR5cGUiOiAiaW50ZWdlciJ9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogeyJ0eXBlIjogImtleXdvcmQifQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFjaWxpdHkiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29kZSI6IHsidHlwZSI6ICJpbnRlZ2VyIn0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7InR5cGUiOiAia2V5d29yZCJ9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICJob3N0bmFtZSI6IHsidHlwZSI6ICJrZXl3b3JkIn0sDQogICAgICAgICAgICAgICAgImV2ZW50X3NvdXJjZSI6IHsidHlwZSI6ICJrZXl3b3JkIn0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHRyeToNCiAgICAgICAgYXN5bmMgd2l0aCBzZXNzaW9uLnB1dCgNCiAgICAgICAgICAgIGYie0VMQVNUSUNfSE9TVH0ve0lOREVYX05BTUV9IiwNCiAgICAgICAgICAgIGpzb249c2V0dGluZ3MsDQogICAgICAgICAgICBhdXRoPWFpb2h0dHAuQmFzaWNBdXRoKEVMQVNUSUNfVVNFUiwgRUxBU1RJQ19QQVNTV09SRCkNCiAgICAgICAgKSBhcyByZXNwb25zZToNCiAgICAgICAgICAgIHByaW50KGYiQ3JlYXRpbmcgbmV3IGluZGV4OiB7YXdhaXQgcmVzcG9uc2UudGV4dCgpfSIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIkVycm9yIGNyZWF0aW5nIGluZGV4OiB7ZX0iKQ0KICAgICAgICBvcy5fZXhpdCgxKQ0KDQoNCmFzeW5jIGRlZiB1cGxvYWRfbG9ncyhmaWxlX3BhdGgpOg0KICAgICIiIlVwbG9hZCBsb2dzIGRpcmVjdGx5IHRvIEVsYXN0aWNzZWFyY2giIiINCiAgICAjIEZpcnN0IGNvdW50IHRvdGFsIGxpbmVzDQogICAgc3RhdHMgPSB7DQogICAgICAgICd0b3RhbF9saW5lcyc6IHN1bSgxIGZvciBfIGluIG9wZW4oZmlsZV9wYXRoLCAncicsIGVuY29kaW5nPWRldGVjdF9maWxlX2VuY29kaW5nKGZpbGVfcGF0aCkpKSwNCiAgICAgICAgJ3ZhbGlkX2pzb24nOiAwLA0KICAgICAgICAncHJvY2Vzc19mYWlsdXJlcyc6IDAsDQogICAgICAgICdiYXRjaF9zZW5kX2ZhaWx1cmVzJzogMCwNCiAgICAgICAgJ3N1Y2Nlc3NmdWxfZG9jcyc6IDAsDQogICAgICAgICdza2lwcGVkX2RvY3MnOiAwDQogICAgfQ0KICAgIA0KICAgIGN1cnJlbnRfYmF0Y2ggPSBbXQ0KICAgIGVycm9yX3NhbXBsZXMgPSBbXQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgYXN5bmMgd2l0aCBhaW9odHRwLkNsaWVudFNlc3Npb24oKSBhcyBzZXNzaW9uOg0KICAgICAgICAgICAgYXdhaXQgZGVsZXRlX2FuZF9jcmVhdGVfaW5kZXgoc2Vzc2lvbikNCg0KICAgICAgICAgICAgIyBEZXRlY3QgZmlsZSBlbmNvZGluZw0KICAgICAgICAgICAgZW5jb2RpbmcgPSBkZXRlY3RfZmlsZV9lbmNvZGluZyhmaWxlX3BhdGgpDQogICAgICAgICAgICBwcmludChmIkRldGVjdGVkIGZpbGUgZW5jb2Rpbmc6IHtlbmNvZGluZ30iKQ0KICAgICAgICAgICANCiAgICAgICAgICAgIGJhdGNoX251bSA9IDANCiAgICAgICAgICAgIHByb2Nlc3NlZF9saW5lcyA9IDANCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJywgZW5jb2Rpbmc9ZW5jb2RpbmcpIGFzIGZpbGU6DQogICAgICAgICAgICAgICAgZm9yIGxpbmVfbnVtLCBsaW5lIGluIGVudW1lcmF0ZShmaWxlLCAxKToNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IGJvdGggSlNPTiBhbmQgUkZDIHRleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvYywgcmZjX3RleHQgPSBleHRyYWN0X2pzb25fYW5kX3JmYyhsaW5lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGRvYzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1sndmFsaWRfanNvbiddICs9IDEgICMgQ291bnQgdmFsaWQgSlNPTiBkb2NzIGhlcmUNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGRvY3VtZW50IHdpdGggUkZDIHRleHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZF9kb2MgPSBwcm9jZXNzX2RvY3VtZW50KGRvYywgcmZjX3RleHQpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2JhdGNoLmFwcGVuZChwcm9jZXNzZWRfZG9jKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkX2xpbmVzICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBTZW5kIGJhdGNoIGlmIGZ1bGwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X2JhdGNoKSA+PSBCQVRDSF9TSVpFOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG5TZW5kaW5nIGJhdGNoIHtiYXRjaF9udW19ICh7bGVuKGN1cnJlbnRfYmF0Y2gpfSBkb2N1bWVudHMpIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2NzX3NlbnQgPSBhd2FpdCBzZW5kX2JhdGNoKHNlc3Npb24sIGN1cnJlbnRfYmF0Y2gsIGJhdGNoX251bSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkb2NzX3NlbnQgPCBsZW4oY3VycmVudF9iYXRjaCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzWydiYXRjaF9zZW5kX2ZhaWx1cmVzJ10gKz0gKGxlbihjdXJyZW50X2JhdGNoKSAtIGRvY3Nfc2VudCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1snc3VjY2Vzc2Z1bF9kb2NzJ10gKz0gZG9jc19zZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQcmludCBkZXRhaWxlZCBwcm9ncmVzcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiXHJQcm9jZXNzZWQge2xpbmVfbnVtfS97c3RhdHNbJ3RvdGFsX2xpbmVzJ119IGxpbmVzICINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIih7KGxpbmVfbnVtL3N0YXRzWyd0b3RhbF9saW5lcyddKSoxMDA6LjJmfSUpIC0gIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYiVmFsaWQgSlNPTjoge3N0YXRzWyd2YWxpZF9qc29uJ119IC0gIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYiU3VjY2Vzc2Z1bDoge3N0YXRzWydzdWNjZXNzZnVsX2RvY3MnXX0iLCBlbmQ9JycsIGZsdXNoPVRydWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9iYXRjaCA9IFtdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2hfbnVtICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbJ3Byb2Nlc3NfZmFpbHVyZXMnXSArPSAxDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdGF0c1sncHJvY2Vzc19mYWlsdXJlcyddIDwgNToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9zYW1wbGVzLmFwcGVuZChmIlByb2Nlc3MgZmFpbHVyZSBsaW5lIHtsaW5lX251bX06IHtzdHIoZSl9IikNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgICAgICAjIFNlbmQgZmluYWwgYmF0Y2gNCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X2JhdGNoOg0KICAgICAgICAgICAgICAgICAgICBwcmludChmIlxuU2VuZGluZyBmaW5hbCBiYXRjaCAoe2xlbihjdXJyZW50X2JhdGNoKX0gZG9jdW1lbnRzKSIpDQogICAgICAgICAgICAgICAgICAgIGRvY3Nfc2VudCA9IGF3YWl0IHNlbmRfYmF0Y2goc2Vzc2lvbiwgY3VycmVudF9iYXRjaCwgYmF0Y2hfbnVtKQ0KICAgICAgICAgICAgICAgICAgICBpZiBkb2NzX3NlbnQgPCBsZW4oY3VycmVudF9iYXRjaCk6DQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1snYmF0Y2hfc2VuZF9mYWlsdXJlcyddICs9IChsZW4oY3VycmVudF9iYXRjaCkgLSBkb2NzX3NlbnQpDQogICAgICAgICAgICAgICAgICAgIHN0YXRzWydzdWNjZXNzZnVsX2RvY3MnXSArPSBkb2NzX3NlbnQNCg0KICAgICAgICAgICAgcHJpbnQoIlxuXG5Qcm9jZXNzaW5nIFN1bW1hcnk6IikNCiAgICAgICAgICAgIHByaW50KGYiVG90YWwgbGluZXMgaW4gZmlsZToge3N0YXRzWyd0b3RhbF9saW5lcyddfSIpDQogICAgICAgICAgICBwcmludChmIlZhbGlkIEpTT04gb2JqZWN0cyBmb3VuZDoge3N0YXRzWyd2YWxpZF9qc29uJ119IikNCiAgICAgICAgICAgIHByaW50KGYiU3VjY2Vzc2Z1bGx5IGluZGV4ZWQ6IHtzdGF0c1snc3VjY2Vzc2Z1bF9kb2NzJ119IikNCiAgICAgICAgICAgIHByaW50KGYiUHJvY2VzcyBmYWlsdXJlczoge3N0YXRzWydwcm9jZXNzX2ZhaWx1cmVzJ119IikNCiAgICAgICAgICAgIHByaW50KGYiQmF0Y2ggc2VuZCBmYWlsdXJlczoge3N0YXRzWydiYXRjaF9zZW5kX2ZhaWx1cmVzJ119IikNCiAgICAgICAgICAgIHByaW50KGYiTWlzc2luZyBkb2N1bWVudHM6IHtzdGF0c1sndmFsaWRfanNvbiddIC0gc3RhdHNbJ3N1Y2Nlc3NmdWxfZG9jcyddfSIpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGVycm9yX3NhbXBsZXM6DQogICAgICAgICAgICAgICAgcHJpbnQoIlxuU2FtcGxlIEVycm9yczoiKQ0KICAgICAgICAgICAgICAgIGZvciBzYW1wbGUgaW4gZXJyb3Jfc2FtcGxlczoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoc2FtcGxlKQ0KDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIlxuRXJyb3IgZHVyaW5nIHVwbG9hZDoge2V9IikNCiAgICAgICAgcmFpc2UNCg0KICAgIHJldHVybiBzdGF0c1snc3VjY2Vzc2Z1bF9kb2NzJ10NCg0KDQphc3luYyBkZWYgbWFpbigpOg0KICAgIGxvZ19maWxlID0gYXJncy5sb2dzDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOg0KICAgICAgICBwcmludChmIkVycm9yOiBGaWxlIG5vdCBmb3VuZCAtIHtsb2dfZmlsZX0iKQ0KICAgICAgICBvcy5fZXhpdCgxKQ0KDQogICAgc3RhcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpDQogICAgdHJ5Og0KICAgICAgICB0b3RhbF9kb2NzID0gYXdhaXQgdXBsb2FkX2xvZ3MobG9nX2ZpbGUpDQogICAgICAgIGR1cmF0aW9uID0gZGF0ZXRpbWUubm93KCkgLSBzdGFydF90aW1lDQogICAgICAgIHByaW50KGYiXG5VcGxvYWQgY29tcGxldGVkIHN1Y2Nlc3NmdWxseToiKQ0KICAgICAgICBwcmludChmIlRvdGFsIGRvY3VtZW50cyBwcm9jZXNzZWQ6IHt0b3RhbF9kb2NzfSIpDQogICAgICAgIHByaW50KGYiVGltZSB0YWtlbjoge2R1cmF0aW9ufSIpDQogICAgICAgIHByaW50KGYiQXZlcmFnZSBzcGVlZDoge3RvdGFsX2RvY3MgLyBkdXJhdGlvbi50b3RhbF9zZWNvbmRzKCk6LjJmfSBkb2NzL3NlY29uZCIpDQogICAgICAgIG9zLl9leGl0KDApDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIlxuVXBsb2FkIGZhaWxlZDoge2V9IikNCiAgICAgICAgb3MuX2V4aXQoMSkNCg0KaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoNCiAgICB0cnk6DQogICAgICAgIGFzeW5jaW8ucnVuKG1haW4oKSkNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICBmaW5hbGx5Og0KICAgICAgICBvcy5fZXhpdCgwKQ=="
echo $b64 | base64 -d > upload.py
unzip ./syslog-sender/assets/log_chunk_1.log.zip -d .
unzip ./syslog-sender/assets/log_chunk_2.log.zip -d .
cat log_chunk_1.log log_chunk_2.log > all_logs.log

# If all_logs.log is exactly 3666359002 bytes, start elastic_upload.py
[ $(stat -c %s all_logs.log) -ne 3666359002 ] && echo "all_logs.log filesize is not 3666359002 bytes" || python3 upload.py --host localhost --logs all_logs.log

```